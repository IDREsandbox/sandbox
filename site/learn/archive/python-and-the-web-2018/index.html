
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.25">
    
    
      
        <title>Python and Web Scraping 2018 - OARC Technology Sandbox</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/style.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#why-bother-scraping" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="OARC Technology Sandbox" class="md-header__button md-logo" aria-label="OARC Technology Sandbox" data-md-component="logo">
      
  <img src="../../../logo.jpg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OARC Technology Sandbox
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Python and Web Scraping 2018
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../work/" class="md-tabs__link">
        
  
    
  
  Work

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../" class="md-tabs__link">
        
  
    
  
  Learn

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../connect/" class="md-tabs__link">
          
  
    
  
  Connect

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../musings/" class="md-tabs__link">
        
  
    
  
  Musings

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="OARC Technology Sandbox" class="md-nav__button md-logo" aria-label="OARC Technology Sandbox" data-md-component="logo">
      
  <img src="../../../logo.jpg" alt="logo">

    </a>
    OARC Technology Sandbox
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../work/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Work
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Learn
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../connect/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Connect
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Connect
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../connect/consult/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Consult
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../connect/where/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Where is the Sandbox?
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../musings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Musings
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-bother-scraping" class="md-nav__link">
    <span class="md-ellipsis">
      Why bother scraping?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-setting-up-the-script-and-selenium" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1 - Setting up the script and Selenium
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-getting-one-piece-of-data-first" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2 - Getting one piece of data first
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#print-data_lines-shows-us-the-data-table" class="md-nav__link">
    <span class="md-ellipsis">
      print data_lines ## shows us the data table
    </span>
  </a>
  
    <nav class="md-nav" aria-label="print data_lines ## shows us the data table">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-3-a-wide-range-of-loops" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3 - A wide range of loops!
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-see-us-csving-the-data" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4 - See us CSVing the data!
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#open-the-csv-file-in-excel" class="md-nav__link">
    <span class="md-ellipsis">
      Open the CSV file in Excel:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#go-to-part-2-visualizing-data-with-python" class="md-nav__link">
    <span class="md-ellipsis">
      Go to Part 2: Visualizing Data with Python
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h3 id="why-bother-scraping">Why bother scraping?<a class="headerlink" href="#why-bother-scraping" title="Permanent link">&para;</a></h3>
<p>Data is all around us.. you can download multiple data sets from the <a href="https://data.lacity.org/">LA Open Data</a> portal, use the <a href="https://www.yelp.com/developers">Yelp API</a> to get restaurant reviews, or download your own history on social media... so why would it be necessary to scrape data <strong>and</strong> why would Python be a good candidate?</p>
<p>Let's say I am a climate researcher and I would like to grab historical data from weather sources.. So, I search for "historical weather data"... and I get a similar page:</p>
<p><a href="https://sandbox.idre.ucla.edu/sandbox/wp-content/uploads/2018/10/2018-10-08-17_08_33-Arrest-Log-2010-with-addresses.xlsx-Excel.png"><img alt="" src="images/2018-10-08-17_08_33-Arrest-Log-2010-with-addresses.xlsx-Excel-e1539044216598-1024x717.png" /></a>While the <a href="https://www.ncei.noaa.gov/">National Oceanic and Atmospheric Agency</a> website <a href="https://sandbox.idre.ucla.edu/sandbox/wp-content/uploads/2018/10/1marker.png"><img alt="" src="images/1marker-e1539044099777.png" /></a> should be trustworthy, I want to cross verify this data I've downloaded.</p>
<p>So I would like to use another service, let's check out the Weather Underground link <a href="https://sandbox.idre.ucla.edu/sandbox/wp-content/uploads/2018/10/2marker-e1539044149447.png"><img alt="" src="images/2marker-e1539044149447.png" /></a> :</p>
<p><a href="https://www.wunderground.com/history/">https://www.wunderground.com/history/</a></p>
<p>Looking good, there's a place to enter a location! We'll use UCLA's zipcode which is:</p>
<p>90095</p>
<p><a href="https://sandbox.idre.ucla.edu/sandbox/wp-content/uploads/2018/10/2018-10-08-16_52_24-Weather-History-Data-Archive-_-Weather-Underground.png"><img alt="" src="images/2018-10-08-16_52_24-Weather-History-Data-Archive-_-Weather-Underground-e1539044246153-1024x487.png" /></a>Then we'll hit Submit and on the next page, make sure to switch to monthly view:</p>
<p><a href="https://sandbox.idre.ucla.edu/sandbox/wp-content/uploads/2018/10/2018-10-08-16_54_42-Santa-Monica-Municipal_v2.png"><img alt="" src="images/2018-10-08-16_54_42-Santa-Monica-Municipal_v2-e1539044261614-1024x625.png" /></a>Cool! We can get historical data going to at least the 1970s! Let's check out their API by clicking on the link at the bottom of the page:</p>
<p><a href="https://sandbox.idre.ucla.edu/sandbox/wp-content/uploads/2018/10/2018-10-08-17_00_07-.png"><img alt="" src="images/2018-10-08-17_00_07--1024x465.png" /></a></p>
<p>Upon clicking the page.. we learn that the API is:</p>
<p><strong>No longer accessible..</strong></p>
<p><a href="https://sandbox.idre.ucla.edu/sandbox/wp-content/uploads/2018/10/2018-10-08-17_04_13-API-_-Weather-Underground_v3.png"><img alt="" src="images/2018-10-08-17_04_13-API-_-Weather-Underground_v3-e1539044276215-1024x602.png" /></a>So looks like if we really want to use this data we can copy and paste the data by hand, or we can programmatically download it!</p>
<p>So, let's get to it shall we?</p>
<h3 id="step-1-setting-up-the-script-and-selenium">Step 1 - Setting up the script and Selenium<a class="headerlink" href="#step-1-setting-up-the-script-and-selenium" title="Permanent link">&para;</a></h3>
<p>In most cases, we would use something simple like, "requests" to request data, however because the data on Weather Underground is loaded through JavaScript, we need to use a headless browser... Perfect for the spirit of Halloween, right?</p>
<p>The tool we will be using is called "Selenium" and you can learn more about it here:</p>
<p><a href="https://selenium-python.readthedocs.io/">https://selenium-python.readthedocs.io/</a></p>
<p>Selenium, allows Python to run a headless browser which means you can send keyboard strokes, click on page buttons, and do other nifty stuff with websites. Selenium can also identify content and look for specific items!</p>
<p>For the adventurous and daring, here is a handy Selenium cheat-sheet:</p>
<p><a href="https://codoid.com/selenium-webdriver-python-cheat-sheet/">https://codoid.com/selenium-webdriver-python-cheat-sheet/</a></p>
<p>Excited yet?</p>
<p>Well, to install it there are two steps:</p>
<ol>
<li>Install Selenium through using: pip install selenium</li>
<li>Install a headless web driver by downloading one here:  <a href="https://github.com/mozilla/geckodriver/releases">https://github.com/mozilla/geckodriver/releases</a><ol>
<li>This is the key component of Selenium, and we will be using the Firefox web driver (Gecko) please visit the link here to download it for your operating system:<ul>
<li><strong>Windows:</strong> Copy and paste the geckodriver.exe  file into your Python directory ("C:\Python")</li>
<li><strong>Mac:</strong> you can run "brew install geckodriver "</li>
<li><strong>Linux:</strong> extract the tar file and open up the shell and add the path to the GeckoDriver to your system path:<code>export PATH=$PATH:/path/to/directory/of/executable/downloaded/webdriver</code></li>
</ul>
</li>
</ol>
</li>
</ol>
<p>Ok, with installation out of the way, time to test out if the installation works!</p>
<p>Start a new python file in Python IDE (or preferred editor) and add the following lines:</p>
<p>from selenium import webdriver</p>
<p>driver = webdriver.Firefox()
driver.get("https://www.google.com/")
driver.close()</p>
<p>Before running it, can you guess what is happening here?</p>
<p>First, our script is bringing the selenium library's "webdriver".</p>
<p>Next, we using selenium's webdriver to use Firefox and then setting it to a variable called "driver". If you were using a different browser, like Chrome or Edge, you would change this line to be "webdriver.Chrome" or "webdriver.Edge" respectively.</p>
<p>Remember if you don't like variable name "driver," you can change the name (as with all user created variables)!</p>
<p>The last two lines are going to a webpage, using driver.get and then closing the driver.</p>
<h2 id="step-2-getting-one-piece-of-data-first">Step 2 - Getting one piece of data first<a class="headerlink" href="#step-2-getting-one-piece-of-data-first" title="Permanent link">&para;</a></h2>
<p>Our first objective is to get One Piece:</p>
<p>[caption id="attachment_3437" align="alignnone" width="921"]<a href="https://sandbox.idre.ucla.edu/sandbox/wp-content/uploads/2018/10/2018-10-09-19_59_12-.png"><img alt="" src="images/2018-10-09-19_59_12--e1539140520286.png" /></a> The D stands for data.[/caption]</p>
<p>Using our previous code, we are going to check out the address of Weather Underground site:</p>
<p>https://www.wunderground.com/history/monthly/us/ca/santa-monica/KSMO/date/2018-10</p>
<p>Let's copy that into our script, thereby replacing our "google.com" link.</p>
<p>Referring to the Selenium cheat sheet, we notice there's something called, "find_element_by_class_name"! That sounds perfect!</p>
<p>Hold up, why? Well, all web content is organized in various ways, such as html tags and css classes. How we can identify the content we want is through right clicking and inspecting and element:</p>
<p><a href="https://sandbox.idre.ucla.edu/sandbox/wp-content/uploads/2018/10/2018-10-09-19_26_01_inspect_element.png"><img alt="" src="images/2018-10-09-19_26_01_inspect_element-1024x561.png" /></a></p>
<p>After clicking that, the debug tool bar will show up, and you can see the name of the content you are looking for (it will also highlight that on the page!):</p>
<p><a href="https://sandbox.idre.ucla.edu/sandbox/wp-content/uploads/2018/10/2018-10-09-19_28_40-.png"><img alt="" src="images/2018-10-09-19_28_40--1024x502.png" /></a></p>
<p>Let's find the right container for our data...</p>
<p>Aha! The summary-table looks like the perfect match:</p>
<p><a href="https://sandbox.idre.ucla.edu/sandbox/wp-content/uploads/2018/10/2018-10-09-19_31_32-Santa-Monica-Municipal-CA-History-_-Weather-Underground.png"><img alt="" src="images/2018-10-09-19_31_32-Santa-Monica-Municipal-CA-History-_-Weather-Underground-1024x495.png" /></a></p>
<p>So... using the power of the cheat sheet, or line will look like this:</p>
<p>driver.find_element_by_class_name("summary-table")   ## returns just the table we are interested in</p>
<p>This line is incomplete! Any ideas why?</p>
<p>Correct, it needs to be assigned to a variable, or else we can do anything with it!</p>
<p>Let's call it "elem", short for "elementary my dear Watson.":</p>
<p>elem = driver.find_element_by_class_name("summary-table")</p>
<p>The next step is to only get the text data in that table, luckily we will use Selenium clever tool called... .text on the "elem" variable:</p>
<p>data = elem.text</p>
<p>We'll also print our data so we can see it:</p>
<p>print data</p>
<p>And because we only want one piece of data, average temperature, we will use .split() to divide our text up based on a new line, which in Python looks like "\n" .</p>
<p>data_lines = data.split("\n")</p>
<p>At this point our script should look like this:</p>
<p>from selenium import webdriver
from selenium.webdriver.common.keys import Keys</p>
<p>driver = webdriver.Firefox()
driver.get("https://www.wunderground.com/history/monthly/us/ca/santa-monica/KSMO/date/2018-10")</p>
<p>elem = driver.find_element_by_class_name("summary-table") 
data = elem.text
print data
data_lines = data.split("\n")
driver.close()</p>
<p>Not too interesting at the moment, but if you want you can also add a print data_lines so you can see the separated content of our data!</p>
<p>The time has come to make a loop and grab the only piece of data we are interested in, the average temperatures for a month.</p>
<p>Start by making a Python for-loop that splits the content of the lines based on spaces:</p>
<p>for line in data_lines:
    line_content = line.split(" ")</p>
<p>With that out of the way, we just need to account for the first two lines, because "Avg Temperature" is our way of making sure we got the correct line of data. Besides, data without labels is pretty hard to work with!</p>
<p>So we'll use an "if statement" that looks for the "Avg" within the first line content.. this means if the line starts with "Avg", that the average temperature line we are looking for! Recall that [0] means the first object in that list!</p>
<p>if line_content[0] == "Avg":</p>
<p>Next we will join the lines together using the .join() function and set it to be the first two content of the lines:</p>
<p>data_title = " ".join(new_line[:2])</p>
<p>I use the name "data_title" as it refers "avg temperature" which is the data we are aiming for.</p>
<p>We will then join the rest of the data together using a comma separator and the reverse of the index command we just used:</p>
<div class="codehilite"><pre><span></span><code>    sep = &quot;,&quot;
    temp\_data = sep.join(new\_line\[2:\])
    line\_data = title+sep+temp\_data
    print line\_data
</code></pre></div>

<p>The sep  variable is optional, but it makes the code more flexible in case we no longer like commas and want to use another separator.</p>
<p>Wallah! This should print out the data for October 2018, unless you forget to copy the line, print line_data !</p>
<p>Our code should look like this:</p>
<p>from selenium import webdriver
from selenium.webdriver.common.keys import Keys</p>
<p>driver = webdriver.Firefox()
driver.get("https://www.wunderground.com/history/monthly/us/ca/santa-monica/KSMO/date/2018-10")</p>
<p>elem = driver.find_element_by_class_name("summary-table")   ## returns just the table we are interested in
data = elem.text
data_lines = data.split("\n")</p>
<h1 id="print-data_lines-shows-us-the-data-table">print data_lines                                          ## shows us the data table<a class="headerlink" href="#print-data_lines-shows-us-the-data-table" title="Permanent link">&para;</a></h1>
<p>for line in data_lines:
    line_content = line.split(" ")
    if line_content[0] == "Avg":
        data_title = " ".join(new_line[:2])
        sep = ","
        temp_data = sep.join(new_line[2:])
        line_data = title+sep+temp_data
        print line_data
driver.close()</p>
<h2 id="step-3-a-wide-range-of-loops">Step 3 - A wide range of loops!<a class="headerlink" href="#step-3-a-wide-range-of-loops" title="Permanent link">&para;</a></h2>
<p>With one piece of data out of the way we are now going loop through the data and get even more data sets!</p>
<p>Our objective is to use Weather Underground's historical data, and remembering that the url ends with the "year-month" format, this means we need to format our dates accordingly!</p>
<p>One good way to start this next step is to open a new file, because we don't need the browser just yet!</p>
<p>Let's create a variable for start year and end year, to signify what period we want to look at.</p>
<p>We'll also create an empty array called "study_period" that contains all the dates we will be looking at.</p>
<p>start_year = 2017
end_year = 2018</p>
<p>study_period = []</p>
<p>We will then create a function that will format the dates in the way we need:</p>
<p>def add_month_to_years(year,month):
    this_period = str(year) +"-"+ str(month)
    study_period.append(this_period)</p>
<p>Because this is a function, I opted to use "-" instead of a variable for the separator to keep it short and memory efficient. The two parameters I am creating are "year" and "month" which are then put into the "this_period" variable combined with the "-" character. Lastly, we will then add the data to the study_period array using append().</p>
<p>The next step is to go through each year from our start_year and end_year variables and then add the months to it:</p>
<p>for years in range(start_year,end_year+1):
    for month in range(1,13):
        add_month_to_years(years,month)
print study_period</p>
<p>Notice how +1 is added to end_year and the range? Recall that in Python Indexes begin at 0, so to use real numbers, 1 extra value needs to be added, or else the range will stop too early (at 11 in the case of the month).</p>
<p>We also use the function we created, which nicely adds all the data into our study_period array. The last line is to print out the final array.</p>
<p>Our code should look like this:</p>
<p>start_year = 2017
end_year = 2018</p>
<p>study_period = []</p>
<p>def add_month_to_years(year,month):
    this_period = str(year) +"-"+ str(month)
    study_period.append(this_period)</p>
<p>for years in range(start_year,end_year+1):
    for month in range(1,13):
        add_month_to_years(years,month)
print study_period</p>
<p>If it runs and you have the data all nice, the time has come to integrate it into our main code by the magic of copy and pasting!</p>
<p>After doing so, we need to in case our lines beginning with "driver.get()" to "line_data" in a for loop, like so:</p>
<p>for time in study_period:
    driver.get("https://www.wunderground.com/history/monthly/us/ca/santa-monica/KSMO/date/2018-10)
    elem = driver.find_element_by_class_name("summary-table")   ## returns just the table we are interested in
    data = elem.text
    data_lines = data.split("\n")                                  <br />
    for line in data_lines:
        new_line = line.split(" ")
        if new_line[0] == "Avg":
            sep = ","
            data_title = " ".join(new_line[:2])
            temp_data = sep.join(new_line[2:])
            line_data = data_title+sep+temp_data</p>
<p>No we will replace 2018-10  in our url with "time" so that we loop through all the times we made earlier!</p>
<p>We will also add time to "line_data" or else we won't know what time period the data represents. Remember to add the sep in between data_title and time or your data will be combined together.</p>
<p>Finally, we will create a new array outside of the loop called collected_temperature_data and append to this array right after line_data.</p>
<p>Our mostly completed code should look like this:</p>
<p>from selenium import webdriver
from selenium.webdriver.common.keys import Keys</p>
<p>driver = webdriver.Firefox()</p>
<p>start_year = 2017
end_year = 2018</p>
<p>study_period = []</p>
<p>def add_month_to_years(year,month):
    this_period = str(year) +"-"+ str(month)
    study_period.append(this_period)</p>
<p>for years in range(start_year,end_year+1):
    for month in range(1,13):
        add_month_to_years(years,month)
print study_period</p>
<p>collected_temperature_data = []</p>
<p>for time in study_period:
    driver.get("https://www.wunderground.com/history/monthly/us/ca/santa-monica/KSMO/date/"+time)
    elem = driver.find_element_by_class_name("summary-table") <br />
    data = elem.text
    data_lines = data.split("\n")
    # print data_lines                                        <br />
    for line in data_lines:
        new_line = line.split(" ")
        if new_line[0] == "Avg":
            sep = ","
            data_title = " ".join(new_line[:2])
            temp_data = sep.join(new_line[2:])
            line_data = time+sep+title+sep+temp_data              <br />
            collected_temperature_data.append(line_data)
driver.close()</p>
<p>After successfully running this we will be on the last step!</p>
<h2 id="step-4-see-us-csving-the-data">Step 4 - See us CSVing the data!<a class="headerlink" href="#step-4-see-us-csving-the-data" title="Permanent link">&para;</a></h2>
<p>Now we are at the stage of saving our data! So now, we will import the csv module which makes reading and writing csv files a snap! What is a CSV file you might ask? Well, a CSV is a text file that separates data with commas! Very handy for data analysis!</p>
<p>Add this line to the top of our file:</p>
<p>import csv</p>
<p>After the line, "end_year" you can then also write the headers for our data and define the target csv file as out_file, which will be written to using the csv.writer() method:</p>
<p>out_file = open('average_temperature_'+str(start_year)+'_to_'+str(end_year)+'.csv', "wb")
writer = csv.writer(out_file)
writer.writerow(["Year-Month,Data-Title,Min,Avg,Max,Sum"])</p>
<p>Out_file looks complicated because it uses our start and end years to name our csv file. Now when you run the script a csv file with the start and end year will be created.</p>
<p>Writer.writerow is where we define our headers, and it gets written to the csv file.</p>
<p>Finally at the very end of our script,  we loop through our collected_temperature_data variable and write the data too:</p>
<p>for line in collected_temperature_data:
    writer.writerow([line])</p>
<p>Wallah! You are done! The final script should look like the following:</p>
<p>import csv</p>
<p>from selenium import webdriver
from selenium.webdriver.common.keys import Keys</p>
<p>driver = webdriver.Firefox()</p>
<p>start_year = 2017
end_year = 2017</p>
<p>study_period = []
outfile = open('average_temperature_'+str(start_year)+'_to_'+str(end_year)+'.csv', "wb")
writer = csv.writer(outfile)
writer.writerow(["Year-Month,Data-Title,Min,Avg,Max,Sum"])</p>
<p>def add_month_to_years(year,month):
    this_period = str(year) +"-"+ str(month)
    study_period.append(this_period)</p>
<p>for years in range(start_year,end_year+1):
    for month in range(1,13):
        add_month_to_years(years,month)</p>
<p>collected_temperature_data = []</p>
<p>for time in study_period:
    driver.get("https://www.wunderground.com/history/monthly/us/ca/santa-monica/KSMO/date/"+time)
    elem = driver.find_element_by_class_name("summary-table")   ## returns just the table we are interested in
    data = elem.text
    data_lines = data.split("\n")
    # print data_lines                                          ## shows us the data table
    for line in data_lines:
        new_line = line.split(" ")
        if new_line[0] == "Avg":
            sep = ","
            data_title = " ".join(new_line[:2])
            temp_data = sep.join(new_line[2:])
            line_data = time+sep+data_title+sep+temp_data                ## we put the year-month, tricky title, and temperature data here
            collected_temperature_data.append(line_data)
    print collected_temperature_data
driver.close()</p>
<p>for line in collected_temperature_data:
    writer.writerow([line])</p>
<p>print "you have finished the data collection!"</p>
<h2 id="open-the-csv-file-in-excel">Open the CSV file in Excel:<a class="headerlink" href="#open-the-csv-file-in-excel" title="Permanent link">&para;</a></h2>
<p>Let's open the CSV file to see if there any issues!</p>
<p><a href="https://sandbox.idre.ucla.edu/sandbox/wp-content/uploads/2018/10/2018-10-10-11_12_29-average_temperature_2017_to_2017.csv-Excel.png"><img alt="" src="images/2018-10-10-11_12_29-average_temperature_2017_to_2017.csv-Excel-e1539195182821.png" /></a></p>
<p>Aha! The script puts our data in one column.. So let's use Text to Columns  and save out the CSV file correctly:</p>
<p><a href="https://sandbox.idre.ucla.edu/sandbox/wp-content/uploads/2018/10/2018-10-10-11_13_21-average_temperature_2017_to_2017.csv-Excel.png"><img alt="" src="images/2018-10-10-11_13_21-average_temperature_2017_to_2017.csv-Excel-1024x455.png" /></a></p>
<p>Choose "delimited" and then use the "comma" as the separator:</p>
<p><a href="https://sandbox.idre.ucla.edu/sandbox/wp-content/uploads/2018/10/2018-10-10-11_14_44-average_temperature_2017_to_2017.csv-Excel.png"><img alt="" src="images/2018-10-10-11_14_44-average_temperature_2017_to_2017.csv-Excel-e1539195339753.png" /></a></p>
<p>Your final file should look like this:</p>
<p><a href="https://sandbox.idre.ucla.edu/sandbox/wp-content/uploads/2018/10/2018-10-10-11_18_01-average_temperature_2017_to_2017.csv-Excel.png"><img alt="" src="images/2018-10-10-11_18_01-average_temperature_2017_to_2017.csv-Excel-e1539195510842.png" /></a></p>
<p>If you are at this point, we are ready to visualize!</p>
<h2 id="go-to-part-2-visualizing-data-with-python"><a href="https://sandbox.idre.ucla.edu/sandbox/visualizing-data-with-python">Go to Part 2: Visualizing Data with Python</a><a class="headerlink" href="#go-to-part-2-visualizing-data-with-python" title="Permanent link">&para;</a></h2>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.indexes"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.081f42fc.min.js"></script>
      
        <script src="../../../js/getdata.js"></script>
      
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>