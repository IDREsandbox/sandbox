
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.3">
    
    
      
        <title>Spatializing Data with R - OARC Technology Sandbox</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/style.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#spatializing-data-with-r" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="OARC Technology Sandbox" class="md-header__button md-logo" aria-label="OARC Technology Sandbox" data-md-component="logo">
      
  <img src="../../../logo.jpg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OARC Technology Sandbox
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Spatializing Data with R
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../work/" class="md-tabs__link">
        
  
    
  
  Work

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../" class="md-tabs__link">
        
  
    
  
  Learn

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../connect/" class="md-tabs__link">
          
  
    
  
  Connect

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../musings/" class="md-tabs__link">
        
  
    
  
  Musings

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="OARC Technology Sandbox" class="md-nav__button md-logo" aria-label="OARC Technology Sandbox" data-md-component="logo">
      
  <img src="../../../logo.jpg" alt="logo">

    </a>
    OARC Technology Sandbox
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../work/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Work
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Learn
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../connect/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Connect
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Connect
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../connect/consult/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Consult
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../connect/where/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Where is the Sandbox
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../musings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Musings
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#data" class="md-nav__link">
    <span class="md-ellipsis">
      Data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#r-rstudio" class="md-nav__link">
    <span class="md-ellipsis">
      R + RStudio
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing-tmap" class="md-nav__link">
    <span class="md-ellipsis">
      Installing tmap
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sources" class="md-nav__link">
    <span class="md-ellipsis">
      Sources
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="spatializing-data-with-r">Spatializing Data with R<a class="headerlink" href="#spatializing-data-with-r" title="Permanent link">&para;</a></h1>
<p>While WYSIWYG software packages like <a href="https://www.esri.com/en-us/arcgis/about-arcgis/overview">ArcGIS</a> and <a href="https://www.qgis.org/">QGIS</a> remain a standard in cartographic representations, open source, scripting solutions have always had a strong cadre of support, especially for advanced spatial research initiatives. With a development history that harks back to the late 1990s, <a href="https://www.r-project.org/">R</a> has been championed as the free and open source programming tool for statisticians the world over. With its growth and foray into data viz, more and more researchers are adopting R as a solution for their spatial needs, due to its scripting capability, and strong statistical integration.</p>
<p>Here, we introduce you to <a href="https://github.com/mtennekes/tmap">tmap</a> (thematic maps), an actively maintained open-source <a href="http://stackoverflow.com/tags/r/info">R</a>-library for drawing thematic maps, written by <a href="http://stackoverflow.com/users/1393348/martijn-tennekes">Martijn Tennekes</a>. </p>
<h3 id="data">Data<a class="headerlink" href="#data" title="Permanent link">&para;</a></h3>
<p>This workshop presumes that you have a basic knowledge on spatial research, and follows up on the <a href="https://sandbox.idre.ucla.edu/sandbox/getting-started-with-spatial-research">Getting Started Spatial Research workshop</a>. Data can be obtained from the <a href="https://data.lacity.org/">LA Data Portal</a> following <a href="https://ucladataguides.readthedocs.io/en/latest/working_with_data/data_portal.html">this tutorial</a>.</p>
<p>You can also use any of the data here:</p>
<p>Sample datasets:</p>
<ul>
<li><a href="http://sandbox.idre.ucla.edu/data/Arrest_Data_2019_09.csv">Los Angeles Arrests in September 2019</a></li>
<li><a href="https://sandbox.idre.ucla.edu/data/gis%20workshop/STOLEN%20BIKE%202019.csv">Stolen Bikes in Los Angeles 2019</a> (<a href="https://data.lacity.org/A-Safe-City/Crime-Data-from-2010-to-Present/63jg-8b9z">source</a>)</li>
<li><a href="https://sandbox.idre.ucla.edu/data/gis%20workshop/CHILD%20ABUSE%202019.csv">Child Abuse 2019</a> (<a href="https://data.lacity.org/A-Safe-City/Crime-Data-from-2010-to-Present/63jg-8b9z">source</a>)</li>
</ul>
<h3 id="r-rstudio">R + RStudio<a class="headerlink" href="#r-rstudio" title="Permanent link">&para;</a></h3>
<p><a href="https://www.r-project.org/">R</a> is a programming language that is especially powerful for data exploration, visualization, and statistical analysis. To interact with R, we use <a href="https://www.rstudio.com/">RStudio</a>. Follow these instructions to ensure that you have the proper environment to get started with your R-based research.</p>
<p><strong>MacOS setup</strong></p>
<p><a href="https://www.youtube.com/watch?v=5-ly3kyxwEg">Video Tutorial</a></p>
<p>Install R by downloading and running <a href="https://cran.r-project.org/bin/macosx/R-latest.pkg">this .pkg file</a> from <a href="https://cran.r-project.org/index.html">CRAN</a>. Also, please install the <a href="https://www.rstudio.com/products/rstudio/download/#download">RStudio IDE</a>.</p>
<p><strong>Windows setup</strong></p>
<p><a href="https://www.youtube.com/watch?v=q0PjTAylwoU">Video Tutorial</a></p>
<p>Install R by downloading and running <a href="https://cran.r-project.org/bin/windows/base/release.htm">this .exe file</a> from <a href="https://cran.r-project.org/index.html">CRAN</a>. Also, please install the <a href="https://www.rstudio.com/products/rstudio/download/#download">RStudio IDE</a>. Note that if you have separate user and admin accounts, you should run the installers as administrator (right-click on .exe file and select "Run as administrator" instead of double-clicking). Otherwise problems may occur later, for example when installing R packages.</p>
<h3 id="installing-tmap">Installing tmap<a class="headerlink" href="#installing-tmap" title="Permanent link">&para;</a></h3>
<p>Launch RStudio to get started. Use the console to follow the commands throughout this workshop. Start with the installation of the "tmap" package. Note that this may take up to <strong>5 minutes</strong> to install (yes, there are lots of dependencies here):</p>
<div class="highlight"><pre><span></span><code>install.packages(&quot;tmap&quot;)
</code></pre></div>
<p>Now that the tmap package is installed, add the following libraries to your current session. Note that "sf" is the library that stands for "<a href="https://r-spatial.github.io/sf/">Simple Features</a>" which allows data to be spatialized for R.</p>
<div class="highlight"><pre><span></span><code>library(tmap)
library(sf)
</code></pre></div>
<p>Load the data. Data can be obtained from the <a href="https://data.lacity.org/">LA Data Portal</a> following <a href="https://ucladataguides.readthedocs.io/en/latest/working_with_data/data_portal.html">this tutorial</a>, or you can download sample datasets from the links provided in the Data section above. Once downloaded, rename the data file to "arrests.csv," and take note of its path in your computer. Enter the following command to assign a variable "arrests" to your data and change the path accordingly.</p>
<p>MacOS example:</p>
<div class="highlight"><pre><span></span><code>arrests &lt;- read.csv(&quot;~/Downloads/gis/arrests.csv&quot;)
</code></pre></div>
<p>Windows example (use double back slashes):</p>
<div class="highlight"><pre><span></span><code>arrests &lt;- read.csv(&quot;C:\\Users\\yohman\\Downloads\\arrests.csv&quot;)
</code></pre></div>
<p>Check your environment tab to see your data, and make sure the "lat" and "lon" columns exist:</p>
<p><a class="glightbox" href="images/rstudio-arrests-data-1024x298.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="rstudio-arrests-data" src="images/rstudio-arrests-data-1024x298.png" /></a></p>
<p>Convert "arrests" into a "simple feature" – a spatial geometry format that is tmap readable – by identifying the longitude and latitude columns, and create a new variable "arrests_sf." Also, set the projection (crs) to <a href="https://epsg.io/4326">4326</a>, which stands for WGS84, a geographic coordinate system that reads decimal degrees globally:</p>
<div class="highlight"><pre><span></span><code>arrests_sf &lt;- st_as_sf(arrests, coords = c(&quot;Lon&quot;, &quot;Lat&quot;), crs = 4326)
</code></pre></div>
<p>Visualize the tabular data and take notice on the new "geometry" column:</p>
<div class="highlight"><pre><span></span><code>view(arrests_sf)
</code></pre></div>
<p><a class="glightbox" href="images/view-arrests_sf.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="view-arrests_sf" src="images/view-arrests_sf.png" /></a></p>
<p>Now starts the tmap magic. With just one command "qtm" which stands for "<a href="https://www.rdocumentation.org/packages/tmap/versions/2.3-1/topics/qtm">quick thematic map plot</a>," you can instantly output a map of your data</p>
<div class="highlight"><pre><span></span><code>qtm(arrests_sf)
</code></pre></div>
<p><a class="glightbox" href="images/image-e1579211829540.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="simple dot map" src="images/image-e1579211829540.png" /></a></p>
<p>Let's change the map into an interactive leaflet map.</p>
<div class="highlight"><pre><span></span><code>tmap_mode(&quot;view&quot;)
qtm(arrests_sf)
</code></pre></div>
<p><a class="glightbox" href="images/leaflet.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="leaflet" src="images/leaflet.png" /></a></p>
<p>Change it back to the original view:</p>
<div class="highlight"><pre><span></span><code>tmap_mode(&quot;plot&quot;)
</code></pre></div>
<p>To give our data spatial bearing, let's bring in a layer for Los Angeles Council Districts. You can download it in SHP (shapefile) format from the <a href="http://boundaries.latimes.com/sets/">LA Times data portal.</a> Save the file and create a variable for the data.</p>
<p><a class="glightbox" href="images/council-districts-from-LA-Times.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="council-districts-from-LA-Times" src="images/council-districts-from-LA-Times.png" /></a></p>
<div class="highlight"><pre><span></span><code>la_council_districts &lt;- read_sf(&quot;C:\\Users\\yohman\\Downloads\\l.a. city council district (2012).shp&quot;)
</code></pre></div>
<p>Visualize the council districts.</p>
<div class="highlight"><pre><span></span><code>qtm(la_council_districts, borders = &#39;gray&#39;,fill=NULL)
</code></pre></div>
<p>Visualize arrests and districts together.</p>
<div class="highlight"><pre><span></span><code>qtm(arrests_sf)+
    qtm(la_council_districts, borders = &#39;gray&#39;,fill=NULL)
</code></pre></div>
<p><a class="glightbox" href="images/arrests-with-council-districts.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="arrests-with-council-districts" src="images/arrests-with-council-districts.png" /></a></p>
<p>Color dots by charge description.</p>
<div class="highlight"><pre><span></span><code>qtm(arrests_sf, dots.col = &quot;Charge.Group.Description&quot;,dots.size = 0.1)+
    qtm(la_council_districts, borders = &#39;darkgray&#39;,fill=NULL)
</code></pre></div>
<p><a class="glightbox" href="images/map-by-charge-type.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="map-by-charge-type" src="images/map-by-charge-type.png" /></a></p>
<p>One map per charge description.</p>
<div class="highlight"><pre><span></span><code>qtm(arrests_sf, dots.col = &quot;Charge.Group.Description&quot;,dots.size = 0.1,by = &quot;Charge.Group.Description&quot;)+
    qtm(la_council_districts, borders = &#39;darkgray&#39;,fill=NULL)
</code></pre></div>
<p><a class="glightbox" href="images/maps-by-charge-type.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="maps-by-charge-type" src="images/maps-by-charge-type.png" /></a></p>
<h3 id="sources">Sources<a class="headerlink" href="#sources" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://github.com/mtennekes/tmap">tmap github</a></li>
<li><a href="https://cran.r-project.org/web/packages/tmap/vignettes/tmap-getstarted.html">tmap: get started!</a></li>
<li>Tennekes, Martijn. "<a href="https://www.jstatsoft.org/article/view/v084i06">tmap: Thematic Maps in R.</a>" <em>Journal of Statistical Software</em> [Online], 84.6 (2018): 1 - 39. Web. 17 Jan. 2020</li>
<li><a href="http://zevross.com/blog/2018/10/02/creating-beautiful-demographic-maps-in-r-with-the-tidycensus-and-tmap-packages/">Creating beautiful demographic maps in R with the tidycensus and tmap packages</a></li>
<li><a href="https://cran.r-project.org/web/packages/tmap/tmap.pdf">tmap official documentation (pdf)</a></li>
<li><a href="https://geocompr.robinlovelace.net/adv-map.html">Geocomputation with R</a></li>
</ul>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.indexes"], "search": "../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
        <script src="../../../js/getdata.js"></script>
      
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>