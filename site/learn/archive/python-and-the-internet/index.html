
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.25">
    
    
      
        <title>Python and the Web - &#8203;</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/style.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#part-i-setting-up-the-script" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="&amp;#8203;" class="md-header__button md-logo" aria-label="&#8203;" data-md-component="logo">
      
  <img src="../../../logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            &#8203;
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Python and the Web
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../" class="md-tabs__link">
        
  
    
  
  Learn

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../work/" class="md-tabs__link">
        
  
    
  
  Work

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../connect/" class="md-tabs__link">
          
  
    
  
  Connect

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../musings/" class="md-tabs__link">
        
  
    
  
  Musings

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="&amp;#8203;" class="md-nav__button md-logo" aria-label="&#8203;" data-md-component="logo">
      
  <img src="../../../logo.png" alt="logo">

    </a>
    &#8203;
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Learn
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../work/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Work
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../connect/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Connect
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Connect
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../connect/consult/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Consult
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../connect/where/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Where is the Sandbox?
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../musings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Musings
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#part-i-setting-up-the-script" class="md-nav__link">
    <span class="md-ellipsis">
      Part I - Setting up the script
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-ii-lets-us-nodes-what-is-going-on" class="md-nav__link">
    <span class="md-ellipsis">
      Part II - Let's us Nodes what is going on
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part II - Let's us Nodes what is going on">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-3-lets-close-the-loop" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3 - Let's close the loop
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-an-array-for-the-image-contents" class="md-nav__link">
    <span class="md-ellipsis">
      set an array for the image contents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loop-for-the-content" class="md-nav__link">
    <span class="md-ellipsis">
      loop for the content
    </span>
  </a>
  
    <nav class="md-nav" aria-label="loop for the content">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-4-put-it-into-a-csv" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4 Put it into a CSV
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#write-the-data-into-the-csv-file" class="md-nav__link">
    <span class="md-ellipsis">
      write the data into the csv file
    </span>
  </a>
  
    <nav class="md-nav" aria-label="write the data into the csv file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#congratulations-you-have-scraped-a-google-page" class="md-nav__link">
    <span class="md-ellipsis">
      Congratulations you have scraped a Google page!!
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extra-step-lets-add-some-user-input" class="md-nav__link">
    <span class="md-ellipsis">
      Extra step: Let's add some user input
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ask-the-user-for-the-search-term" class="md-nav__link">
    <span class="md-ellipsis">
      ask the user for the search term
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ask-the-user-for-the-search-term_1" class="md-nav__link">
    <span class="md-ellipsis">
      ask the user for the search term
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-an-array-for-the-image-contents_1" class="md-nav__link">
    <span class="md-ellipsis">
      set an array for the image contents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loop-for-the-image-source" class="md-nav__link">
    <span class="md-ellipsis">
      loop for the image source
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#define-the-target-csv" class="md-nav__link">
    <span class="md-ellipsis">
      define the target csv
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#write-the-data-into-the-csv-file_1" class="md-nav__link">
    <span class="md-ellipsis">
      write the data into the csv file
    </span>
  </a>
  
    <nav class="md-nav" aria-label="write the data into the csv file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back-to-the-workshop" class="md-nav__link">
    <span class="md-ellipsis">
      Back to the workshop
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h2 id="part-i-setting-up-the-script">Part I - Setting up the script<a class="headerlink" href="#part-i-setting-up-the-script" title="Permanent link">&para;</a></h2>
<p>Start a new python script in either your preferred text editor or Python IDE.</p>
<p>To work with the web, our python script needs to send out data, one way to do this is using the built-in "request" module. Bring it in using the following:</p>
<p>import requests</p>
<p>The only extra library we will be using is lxml, which is a module used to parse and search through xml.</p>
<p>You can either import the whole module with "import lxml" or you can take the classes we are interested in which is the html and etree. For later, we will also need defaultdict from collections too. So the code should look like this:</p>
<p>from lxml import html,etree
from collections import defaultdict</p>
<p>Now, let's use the request by setting a variable and getting a page:</p>
<p>page = requests.get('http://www.google.com/search?tbm=isch&amp;q='+searchTerm)</p>
<p>We could avoid page = <strong>but</strong> we want to use the page we get, so we have to set it to a variable; otherwise it would just be sitting around doing nothing.</p>
<p>Let's use the module we imported and print the result:</p>
<p>print page.content</p>
<p>What does your script return?</p>
<p>In looking at our url http://www.google.com/search?tbm=isch&amp;q=ucla , we can see that q=ucla is our search term, but we are going to make it a variable called search term and add it to the url, like so:</p>
<p>searchTerm = 'ucla'
page = requests.get('http://www.google.com/search?tbm=isch&amp;q='+searchTerm)</p>
<p>Your code should look similar to this:</p>
<p>import requests,os,csv
from lxml import html,etree
from collections import defaultdict</p>
<p>searchTerm = 'ucla'</p>
<p>page = requests.get('http://www.google.com/search?tbm=isch&amp;q='+searchTerm)
print page.content</p>
<h2 id="part-ii-lets-us-nodes-what-is-going-on">Part II - Let's us Nodes what is going on<a class="headerlink" href="#part-ii-lets-us-nodes-what-is-going-on" title="Permanent link">&para;</a></h2>
<p>Next we want to use the tree and html modules, because that allows us to search nodes:</p>
<p>tree = html.fromstring(page.content)</p>
<p>html.fromstring allows us to search the page as a tree, rather than simply text, but how do we search?</p>
<p>We have to use the "xpath" module from the tree.</p>
<p>Let's use an example by grabbing all the links from the page:</p>
<p>for node in tree.xpath('//a/@href'):
    print node</p>
<p>What this does is for all the nodes in tree.xpath , it looks for all the 'a' anchors that have an 'href' attribute and prints the node. With xpath, you can traverse down a tree and grab the children with each '/' character.</p>
<p>[expand title="How would you store the result into a variable?"]</p>
<p>links = tree.xpath('//a/@href')</p>
<p>[/expand]</p>
<p>We are only going to grab the images, so let's use the img tag.</p>
<p>images = tree.xpath('//img')</p>
<p>This should work, but it will return the actual images.. That's no good! We actually want the image sources, so we just need to add another node  to get that attribute called @src</p>
<p>images = tree.xpath('//img/@src')</p>
<p>Feel free to print it out if you'd like.</p>
<p>Your code should look like this:</p>
<p>import requests,os,csv
from lxml import html,etree
from collections import defaultdict</p>
<p>searchTerm = 'ucla'
page = requests.get('http://www.google.com/search?tbm=isch&amp;q='+searchTerm)</p>
<p>tree = html.fromstring(page.content)
images = tree.xpath('//img/@src')
print images</p>
<h3 id="step-3-lets-close-the-loop">Step 3 - Let's close the loop<a class="headerlink" href="#step-3-lets-close-the-loop" title="Permanent link">&para;</a></h3>
<p>Remember that a loop in Python has the following components:</p>
<p>for something in someArray:
    #do something<br></p>
<p>for [simple_tooltip content='This is an alias for indivudal items']something[/simple_tooltip] in [simple_tooltip content='this is a list of items']someArray[/simple_tooltip]: [simple_tooltip content='Here is where you have code to do an action with each item']#do something[/simple_tooltip]<br></p>
<p>For example:</p>
<p>someArray = [0,1,2,3,4,5]</p>
<p>for number in someArray:
    print number</p>
<p>In order to do a loop, something needs be looped over, in this case it is some array of numbers.</p>
<p>Let's add this code to our Google scraper:</p>
<h1 id="set-an-array-for-the-image-contents">set an array for the image contents<a class="headerlink" href="#set-an-array-for-the-image-contents" title="Permanent link">&para;</a></h1>
<p>theData = []</p>
<h1 id="loop-for-the-content">loop for the content<a class="headerlink" href="#loop-for-the-content" title="Permanent link">&para;</a></h1>
<p>for source in images:
    theData.append(source)
    print source</p>
<p>In Line 2, we are creating an empty to store our image source contents, and calling it theData . In line 5, we begin our for-loop. Then we add our content to theData array using theData.append(source) . We can print each clean source if we wanted using print source.</p>
<h2 id="step-4-put-it-into-a-csv">Step 4 Put it into a CSV<a class="headerlink" href="#step-4-put-it-into-a-csv" title="Permanent link">&para;</a></h2>
<p>Now that we have everything cleaned up, we are going to write it to a csv file:</p>
<p>targetFile = open("./"+searchTerm+".csv", "wb")
writer = csv.writer(targetFile)</p>
<p>Line 1 gives us the target file, which is going to be our very own "searchTerm".csv. Line 2 targets our file with csv.writer() , and assigns it to "writer".</p>
<p>We can check our images with the following:</p>
<p>print 'number of images found:',len(images)</p>
<p>Finally, we will do our last for-loop and close the csv file:</p>
<h1 id="write-the-data-into-the-csv-file">write the data into the csv file<a class="headerlink" href="#write-the-data-into-the-csv-file" title="Permanent link">&para;</a></h1>
<p>for row in theData:
    writer.writerow([row])
    print row</p>
<p>targetFile.close()
print "done with script"</p>
<p>Make sure that "row" is within brackets or the csv file will be weird!</p>
<h3 id="congratulations-you-have-scraped-a-google-page">Congratulations you have scraped a Google page!!<a class="headerlink" href="#congratulations-you-have-scraped-a-google-page" title="Permanent link">&para;</a></h3>
<h2 id="extra-step-lets-add-some-user-input">Extra step: Let's add some user input<a class="headerlink" href="#extra-step-lets-add-some-user-input" title="Permanent link">&para;</a></h2>
<p>But wait, instead of searching for "ucla" all the time, we can have the user input a search term by doing the following:</p>
<h1 id="ask-the-user-for-the-search-term">ask the user for the search term<a class="headerlink" href="#ask-the-user-for-the-search-term" title="Permanent link">&para;</a></h1>
<p>searchterm = str(raw_input("What is the search term? \n"))</p>
<p>Your final code should look like the following:</p>
<p>import requests,os,csv
from lxml import html,etree
from collections import defaultdict</p>
<h1 id="ask-the-user-for-the-search-term_1">ask the user for the search term<a class="headerlink" href="#ask-the-user-for-the-search-term_1" title="Permanent link">&para;</a></h1>
<p>searchTerm = str(raw_input("What is the search term? \n"))</p>
<p>page = requests.get('http://www.google.com/search?tbm=isch&amp;q='+searchTerm)</p>
<p>tree = html.fromstring(page.content)
images = tree.xpath('//img/@src')
print images</p>
<h1 id="set-an-array-for-the-image-contents_1">set an array for the image contents<a class="headerlink" href="#set-an-array-for-the-image-contents_1" title="Permanent link">&para;</a></h1>
<p>theData = []</p>
<h1 id="loop-for-the-image-source">loop for the image source<a class="headerlink" href="#loop-for-the-image-source" title="Permanent link">&para;</a></h1>
<p>for source in images:
    cleanSource = source.encode('utf-8')
    theData.append(source)
    print source</p>
<h1 id="define-the-target-csv">define the target csv<a class="headerlink" href="#define-the-target-csv" title="Permanent link">&para;</a></h1>
<p>targetFile = open("./"+searchTerm+".csv", "wb")
writer = csv.writer(targetFile)</p>
<h1 id="write-the-data-into-the-csv-file_1">write the data into the csv file<a class="headerlink" href="#write-the-data-into-the-csv-file_1" title="Permanent link">&para;</a></h1>
<p>for row in theData:
    writer.writerow([row])
    print row</p>
<p>print 'number of images found:',len(images)</p>
<p>targetFile.close()
print "done with script"</p>
<h4 id="back-to-the-workshop"><a href="https://sandbox.idre.ucla.edu/sandbox/web-scrapin-focus-on-python">Back to the workshop</a><a class="headerlink" href="#back-to-the-workshop" title="Permanent link">&para;</a></h4>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.indexes"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.081f42fc.min.js"></script>
      
        <script src="../../../js/getdata.js"></script>
      
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>